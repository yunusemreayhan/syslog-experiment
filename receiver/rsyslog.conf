# rsyslog configuration for receiver

# Load modules
module(load="imudp")
module(load="imtcp")

# Provide UDP syslog reception
input(type="imudp" port="514")

# Provide TCP syslog reception
input(type="imtcp" port="514")

# Template for log format
template(name="RemoteLogFormat" type="string"
         string="%TIMESTAMP% %HOSTNAME% %syslogtag% %msg%\n")

# Template for dynamic file naming
template(name="RemoteHostFile" type="string"
         string="/var/log/remote/%HOSTNAME%/%PROGRAMNAME%.log")

# Rules for remote logs
if $fromhost-ip != '127.0.0.1' then {
    action(type="omfile" 
           dynaFile="RemoteHostFile" 
           template="RemoteLogFormat"
           dirCreateMode="0755"
           fileCreateMode="0644")
    
    # Also log to console for monitoring
    action(type="omfile" 
           file="/dev/stdout" 
           template="RemoteLogFormat")
    
    # Stop processing after handling remote logs
    stop
}

# Log all messages to a single file as well
*.* /var/log/all-messages.log

# Log by severity
*.info;*.notice;*.warn /var/log/messages
*.err /var/log/error.log
*.crit /var/log/critical.log

# Log by facility
auth,authpriv.* /var/log/auth.log
mail.* /var/log/mail.log
cron.* /var/log/cron.log
